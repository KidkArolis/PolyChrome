<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Hello PolyML</title>

<script type="application/x-polyml">
(*print (OS.FileSys.getDir());*)
fun s2i s = valOf (Int.fromString s);
fun i2s i = Int.toString i;
val e = valOf (getElementById document "abc");

fun applyOperation operation =
    let
        val _ = switchNamespace(NONE);
        val current_value = innerHTML e NONE;
        val new_value = operation((s2i current_value), 1);
        val _ = innerHTML e (SOME (i2s new_value));
        val _ = switchNamespace(SOME "temp");
    in
        clearMemory(SOME "temp")
    end;

fun removeToggle1 () =
    let
      val e = valOf (getElementById document "remove1");
      fun a (s) = if (s="remove first listener") then ("add first listener")
                  else ("remove first listener");
      fun b (s) = if (s="remove first listener") then (removeEventListener (valOf (getElementById document "button1")) "click" "applyOperation(op+);")
                  else (addEventListener (valOf (getElementById document "button1")) "click" "applyOperation(op+);");
      val current_value = value e NONE;
      val new_value = a (current_value);
      val _ = value e (SOME new_value);
      val _ = b(current_value);
    in
      clearMemory(SOME "temp")
    end;

fun removeToggle2 () =
    let
      val e = valOf (getElementById document "remove2");
      fun a (s) = if (s="remove second listener") then ("add second listener")
                  else ("remove second listener");
      fun b (s) = if (s="remove second listener") then (removeEventListener (valOf (getElementById document "button2")) "click" "applyOperation(op-);")
                  else (addEventListener (valOf (getElementById document "button2")) "click" "applyOperation(op-);");
      val current_value = value e NONE;
      val new_value = a (current_value);
      val _ = value e (SOME new_value);
      val _ = b(current_value);
    in
      clearMemory(SOME "temp")
    end;

switchNamespace(SOME "temp");
addEventListener (valOf (getElementById document "button1")) "click" "applyOperation(op+);";
removeEventListener (valOf (getElementById document "button1")) "click" "applyOperation(op+);";
removeEventListener (valOf (getElementById document "button1")) "click" "applyOperation(op+);";
addEventListener (valOf (getElementById document "button1")) "click" "applyOperation(op+);";
addEventListener (valOf (getElementById document "button1")) "click" "applyOperation(op+);";
addEventListener (valOf (getElementById document "button2")) "click" "applyOperation(op-);";
addEventListener (valOf (getElementById document "remove1")) "click" "removeToggle1()";
addEventListener (valOf (getElementById document "remove2")) "click" "removeToggle2()";
clearMemory(SOME "temp");
</script>

<style type= "text/css">
    body, html {
        padding:0;
        margin:0;
        font-family: verdana, sans;
        font-size:12px;
        padding:20px;
    }
</style>

</head>
<body>

<div id="body">
    <p id="abc">0</p>
    <input id="button1" type="button" value="add one" />
    <input id="button2" type="button" value="subtract one" />

    <hr />
    <input id="remove1" type="button" value="remove first listener" />
    <input id="remove2" type="button" value="remove second listener" />
</div>

</body>
</html>

