<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PolyML Extension</title>
    <link rel="stylesheet" href="settings.css" type="text/css" />

  </head>
  <body>
    <div id="container">
        
      <div id="logo">
        <img src="../skin/polyml_32x32t.png" />
        <span id="title">PolyML Extension <span id="version"></span></span>
      </div>
      
      <div id="content">
        
      <p id="disclaimer">Use PolyMLext at your own risk. It is not safe to browse internet while PolyMLext is enabled.</p>

      <div id="polymlNotFound" style="display:none">
        <p>PolyML could was not found on this computer.<p>
        <p>Please visit <a href="http://polyml.org/">http://polyml.org/</a> for instructions on installing PolyML.<p>
        <p>You can also provide a custom path to the PolyML in the settings section below.</p>
      </div>
      
      <div class="section">
        <div id="settings">
          <h1>Settings</h1>
          <table>
              <tr>
                  <td class="name"><p>Custom PolyML path<p></td>
                  <td><input type="text" id="prefPolyMLPath"  /></td>
                  <td class="hint">e.g. /home/myname/polyml-5.4</td>
              </tr>
               <tr>
                  <td class="name"><p>Always enable PolyML apps<p></td>
                  <td><input type="checkbox" id="prefAlwaysEnabled" /></td>
                  <td class="hint">If checked, PolyML scripts will be executed without asking for confirmation.</td>
              </tr>
              <tr>
                  <td></td>
                  <td><input type="submit" id="savePrefs" value="Save" /></td>
                  <td></td>
              </tr>
          </table>
        </div>
      </div>

      <div class="section">
        <h1>Resources</h1>
        <ul>
          <li><a href="#" onclick="return false" id="linkDemos">Demos</a></li>
          <li><a href="chrome://polymlext/content/docs/index.html">Documentation</a></li>
          <li><a href="https://www.assembla.com/spaces/polymlext/" target="_blank">Source Code and Issue Tracker</a></li>
        </ul>
      </div>

      </div>
    </div>
    
    <script type="text/javascript">
        var wm = Components.classes["@mozilla.org/appshell/window-mediator;1"]
                .getService(Components.interfaces.nsIWindowMediator);
        var currentWindow = wm.getMostRecentWindow("navigator:browser");
        var PolyMLext = currentWindow.PolyMLext;
        
        var init = function() {
          //shortcut
          var e = function(id) { return document.getElementById(id) }
          
          var noPolyFound = function() {
              if (!PolyMLext.polyFound) {
                  e("polymlNotFound").style["display"] = "block";
              } else {
                  e("polymlNotFound").style["display"] = "none";
              }
          }
          noPolyFound();
          
          e("version").innerHTML = PolyMLext.extension.version;
          
          e("linkDemos").addEventListener("click", function() {
              PolyMLext.BrowserUI.displayDemosPage();
          }, false);
          
          //preferences
          //always enabled pref
          var prefAlwaysEnabled = PolyMLext.BrowserUI.prefs.alwaysEnabled;
          e("prefAlwaysEnabled").checked = prefAlwaysEnabled.value;
          prefAlwaysEnabled.events.addListener("change", function(aEvent) {
              e("prefAlwaysEnabled").checked = prefAlwaysEnabled.value;
          });
          
          //always enabled
          var prefPolyMLPath = PolyMLext.BrowserUI.prefs.PolyMLPath;
          e("prefPolyMLPath").value = prefPolyMLPath.value;
          prefPolyMLPath.events.addListener("change", function(aEvent) {
              e("prefAlwaysEnabled").value = prefPolyMLPath.value;
              PolyMLext.findPoly();
              noPolyFound();
          });
          
          //save prefs
          e("savePrefs").addEventListener("click",
              function() {
                  prefAlwaysEnabled.value = e("prefAlwaysEnabled").checked;
                  //we do a check here not to fire the "change" event initiating
                  //the browser restart if the value wasn't actually changed
                  if (e("prefPolyMLPath").value!=prefPolyMLPath.value) {
                      prefPolyMLPath.value = e("prefPolyMLPath").value;
                  }
                  return false;
              }, false);
        }
        PolyMLext.onReady(init);
    </script>
  </body>
</html>